{
  "hash": "09a27444eccba8101557736c70eccac7",
  "result": {
    "markdown": "---\ntitle: \"Travel patterns in UK cities\"\nsubtitle: |\n  Active travel origin-destination data visualised across major urban areas in the UK\nauthor:\n  name: Nicolas Palominos\ncitation: true\ndate: \"2022-05\"\ndate-format: \"MMMM, YYYY\"\ncategories: [r, od data]\nimage: \"image.png\"\nformat: \n  html:\n    code-fold: true\n    toc: true\n    toc-title: Contents\n    toc-location: left\n---\n\n<!--------------- post ----------------->\n\n### What are the active travel patterns in the UK?\n\nBy visualising a large quantity of travel data we can observe the spatial patterns of different cities[^1].\n\n[^1]: A version of this exercise was featured in the twitter feed of [R posts you might have missed!](https://twitter.com/icymi_r/status/1461532249921368064?s=20&t=TfGwbEICE13mdSCbwDfNcQ)\n\nProvided that travel behaviour is associated with the distance to potentially attractive destinations and that cycling in particular can be sensible not only to distance but also to the quality of cycling infrastructure, the visualisation of cycling flows can reveal interesting patterns of urban morphology. This is particularly relevant for identifying city and neighbourhood level urban adaptations and strategies that can promote more energy and space-efficient modes of travel and contribute to achieving net-zero cities.\n\nThis exercise uses origin-destination data that captures the number of trips by mode between census areas in the UK.\n\n### Prerequisites\n\nThe following packages are necessary to run the code.\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)\nlibrary(pct)\nlibrary(stplanr)\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(extrafont)\nlibrary(patchwork)\n```\n:::\n\n::: {.cell}\n\n:::\n\n### Reading the data\n\nOrigin-destination data is obtained from the R package `pct`[^2]. This code will download all 'flows' data, the centroids of census areas (MSOAs) and PCT defined regions.\n\n[^2]: See the [Propensity to Cycle Tool](https://itsleeds.github.io/pct/) project website\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get origin destination data from the 2011 Census\n# ref: https://www.rdocumentation.org/packages/pct/versions/0.9.1/topics/get_od\nflows <- get_od(\n  region = NULL,\n  n = NULL,\n  type = \"within\",\n  omit_intrazonal = FALSE,\n  base_url = paste0(\"https://s3-eu-west-1.amazonaws.com/\",\n    \"statistics.digitalresources.jisc.ac.uk\", \"/dkan/files/FLOW/\"),\n  filename = \"wu03ew_v2\",\n  u = NULL\n)\n# Download MSOA centroids for England and Wales\nnodes <- get_centroids_ew() \n# Download regions (pct defined regions)\nregions <- pct_regions\n```\n:::\n\n### Bicycle flows\n\nTo filter (slice) flows by mode we follow a standard tidyverse workflow in R that selects unique origins and destinations from the flows and nodes data. The function `od2line` converts the filtered flows and nodes data into an `sf` object.\n\n::: {.cell}\n\n```{.r .cell-code}\nflows %>%\n  filter(bicycle > 0) %>%\n  # remove O-D geo areas that are NA eg. not MSOA\n  filter(!is.na(geo_name2)) -> flows_bike\n# create sf with unique nodes\nx1 <- flows_bike$geo_code1 %>%\n  unique() %>%\n  as.data.frame()\nx2 <- flows_bike$geo_code2 %>%\n  unique() %>%\n  as.data.frame()\nbind_rows(x1, x2) %>%\n  unique() %>%\n  rename(nodes = \".\") -> flows_nodes\n# filter by msoa code\nnodes %>%\n  filter(msoa11cd %in% flows_nodes$nodes) -> nodes_bike\n# Convert origin-destination data to sf lines (od2line {stplanr})\nbike_commute <- od2line(flows_bike, nodes_bike)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\nThe table shows the 6 regions with highest aggregated flows (Total) and the trips of the *desire line* with highest count (Maximum)\n\n::: {.cell tbl-cap='Travel by Bicycle'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Region </th>\n   <th style=\"text-align:right;\"> Total </th>\n   <th style=\"text-align:right;\"> Maximum </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> London </td>\n   <td style=\"text-align:right;\"> 136858 </td>\n   <td style=\"text-align:right;\"> 109 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cambridgeshire </td>\n   <td style=\"text-align:right;\"> 26163 </td>\n   <td style=\"text-align:right;\"> 613 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Hampshire </td>\n   <td style=\"text-align:right;\"> 22513 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Avon </td>\n   <td style=\"text-align:right;\"> 22143 </td>\n   <td style=\"text-align:right;\"> 311 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Greater-Manchester </td>\n   <td style=\"text-align:right;\"> 21099 </td>\n   <td style=\"text-align:right;\"> 55 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Oxfordshire </td>\n   <td style=\"text-align:right;\"> 17271 </td>\n   <td style=\"text-align:right;\"> 444 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n:::\n\nRegions with the higher number of trips by bicycle are highlighted below. Overall, it can be observed that this corresponds with University cities which would tend to have younger populations.\n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\nPlotting each region side-by-side at the same scale allows to compare the different bicycle travel patterns. It is clear that London, for example, tends to be more monocentric than the other regions where more than one bicycle destination is highlighted. \n\n\n\n:::{.column-page}\n![Regions with highest bicycle flows (cut-off square of ~100 kms)](bgrid.png)\n:::\n\n### Walking commute\n\nThe same scripts can be used to visualise the patterns of people on-foot.\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\nWe now observe a different set of regions, however, London and Greater Manchester are still at the top which is not surprising given that these are the most populated areas in the UK.\n\n::: {.cell tbl-cap='Travel by Foot'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Region </th>\n   <th style=\"text-align:right;\"> Total </th>\n   <th style=\"text-align:right;\"> Maximum </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> London </td>\n   <td style=\"text-align:right;\"> 233591 </td>\n   <td style=\"text-align:right;\"> 1293 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Greater-Manchester </td>\n   <td style=\"text-align:right;\"> 76522 </td>\n   <td style=\"text-align:right;\"> 975 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> West-Yorkshire </td>\n   <td style=\"text-align:right;\"> 61787 </td>\n   <td style=\"text-align:right;\"> 798 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Wales </td>\n   <td style=\"text-align:right;\"> 57842 </td>\n   <td style=\"text-align:right;\"> 846 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> West-Midlands </td>\n   <td style=\"text-align:right;\"> 54413 </td>\n   <td style=\"text-align:right;\"> 525 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> North-East </td>\n   <td style=\"text-align:right;\"> 53878 </td>\n   <td style=\"text-align:right;\"> 890 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n:::{.column-page}\n![Foot flows for 6 top cities centred at the _desire line_ with highest count](fgrid.png)\n:::\n\n\n\n\n\nWhen comparing areas with highest bicycle and foot flows it is interesting to note that only London and Manchester have high number of trips for both modes. High performing cities at walking commute that could have the potential to increase bicycle trips are Leeds, Cardiff, Birmingham and Newcastle. From the walking flows it is possible to observe that there is quite a big variation in the length of the _desire line_ with highest flow count (subtitle), varying from 2435 m in London to 772 m in Wales (Cardiff).\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-54-1.png){width=672}\n:::\n:::\n\n### Future points\n\nAs an illustration the bicycle flows plot contains ~300k origin-destination lines. Often, this kind of plots tend to get cluttered making it difficult to identify meaningful patterns (the total number of links between n set of nodes is n(n-1)/2). An important contribution of this graphic is that it can provide a synoptic comparative view of flow patterns that relate to the morphology of cities. Additional quantitative analysis could be done by calculating the centrality degree distribution of the studied areas to investigate how the number of connections vary across origins and destinations.\n\nMoreover, the code in this exercise can be adapted to investigate other patterns by mode of travel or include other parameters such as travel by age groups (see data in UK Data Service[^3]). Additionally, instead of highlighting the areas with high density of active travel flows, this approach could be used to identify areas where there could be a modal shift from car travel to active travel. \n\n[^3]: See [UK Data Service](https://statistics.ukdataservice.ac.uk/dataset/wu03ew-2011-msoamsoa-location-usual-residence-and-place-work-method-travel-work)\n\n::: {.cell}\n\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}